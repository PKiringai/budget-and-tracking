spring:
  application:
    name: budget-tracking

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

    datasource:
      url: ${DB_URL:jdbc:postgresql://172.16.19.33:5999/yfsdb}
      username: yfs_service
      password: 'G7!kL9#pQ2@vX5$mR8^tZ1'
      driver-class-name: org.postgresql.Driver
      hikari:
        maximum-pool-size: ${DB_POOL_SIZE:20}
        minimum-idle: 5
        connection-timeout: 30000
        idle-timeout: 600000
        max-lifetime: 1800000
        connection-test-query: SELECT 1
        pool-name: BudgetTrackerHikariCP

    jpa:
      open-in-view: false
      hibernate:
        ddl-auto: update  # NEVER use update/create in production
        naming:
          physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
          implicit-strategy: org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy
      properties:
        hibernate:
          jdbc:
            batch_size: 20
            fetch_size: 50
          order_inserts: true
          order_updates: true
          format_sql: false
          use_sql_comments: false
          dialect: org.hibernate.dialect.PostgreSQLDialect
          default_schema: public
          temp:
            use_jdbc_metadata_defaults: false
      show-sql: false

  flyway:
      enabled: true
      baseline-on-migrate: true
      baseline-version: 0
      baseline-description: "Existing Schema"
      locations: classpath:db/migration
      validate-on-migrate: true
      out-of-order: false
      schemas: public
      clean-disabled: true

  jackson:
      serialization:
        write-dates-as-timestamps: false
        indent-output: false
      deserialization:
        fail-on-unknown-properties: false
      time-zone: Africa/Nairobi
      default-property-inclusion: non_null
      date-format: yyyy-MM-dd'T'HH:mm:ss.SSSXXX

  # Server configuration
  server:
    port: ${SERVER_PORT:8080}
    compression:
      enabled: true
      mime-types: application/json,application/xml,text/html,text/xml,text/plain
      min-response-size: 1024
    error:
      include-message: always
      include-binding-errors: always
      include-stacktrace: never
      include-exception: false
      whitelabel:
        enabled: false

  # Logging
  logging:
    level:
      root: INFO
      ke.co.coop.budget: INFO
      org.springframework.web: INFO
      org.springframework.security: INFO
      org.hibernate.SQL: INFO
      org.hibernate.type.descriptor.sql.BasicBinder: INFO
    pattern:
      console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"
      file: "%d{yyyy-MM-dd HH:mm:ss.SSS} ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } --- [%t] %-40.40logger{39} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"
    file:
      name: ${LOG_FILE:logs/budget-tracker.log}
      max-size: 10MB
      max-history: 30
      total-size-cap: 1GB

  # Actuator endpoints
  management:
    endpoints:
      web:
        exposure:
          include: health,info,metrics,prometheus
        base-path: /actuator
    endpoint:
      health:
        show-details: when-authorized
        probes:
          enabled: true
    metrics:
      export:
        prometheus:
          enabled: true
      tags:
        application: ${spring.application.name}
        environment: ${spring.profiles.active}
    info:
      env:
        enabled: true

  # Swagger/OpenAPI
  springdoc:
    api-docs:
      path: /api-docs
      enabled: true
    swagger-ui:
      path: /swagger-ui.html
      enabled: true
      operations-sorter: method
      tags-sorter: alpha
      display-request-duration: true
      doc-expansion: none
    show-actuator: false

  # Application specific properties
  app:
    budget:
      alert:
        check-interval: 3600000  # 1 hour in milliseconds
        batch-size: 100
      transaction:
        history-months: 12
        page-size: 20
    security:
      allowed-origins: ${ALLOWED_ORIGINS:http://localhost:3000,http://localhost:4200}
      jwt:
        enabled: ${JWT_ENABLED:false}
